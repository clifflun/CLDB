# Description

CLDB is a Python-based toolkit designed to support flexible management and querying of copy-number variant (CNV) / structural variant (SV) metadata for genomic analyses, particularly in the context of rare disease cohorts. It provides utilities for ingesting sample metadata, filtering and querying CNV/SV call sets, and integrating with visualization and analytic workflows.

This codebase includes modules for querying, helper utilities, web pages, and miscellaneous scripts to build reproducible analysis pipelines.

# Usage

## Launch Instance

1. Clone the Repository

```bash
git clone https://github.com/clifflun/CLDB.git
cd CLDB
```

2. Download the Docker Image

Download the prebuilt Docker image from the provided source (see Docker Image section below).

```bash
docker pull clifflun/sv_db
```

3. Run the Docker Container

Start a Docker container and mount the local CLDB repository into the container. Expose port 8501 to access the web application:

```
docker run -it \
  -p 8501:8501 \
  -v /path/to/CLDB:/CLDB \
 clifflun/sv_db 
```

4. Access the Application

Once the container is running, the application will start automatically.
Open a web browser and navigate to:
```
http://localhost:8501
```


## Create datafile and load to SQL database

0. Edit metadata file 

Column Definitions

-    pt_id: Unique subject identifier 

-    family: Family ID.

-    project: Project ID.

-    is_proband / is_trio: Boolean indicators (1=Yes, 0=No) for pedigree structure.

-    CNV_outlier: Indicates samples flagged during QC (e.g., high SD or DLR spread).

-    sex: Sex of subject.

-    system: Version of sequencing platform.

-    phenotype: Phenotype of subject, if any. 

-    Candidate_Variant: Candidate_Variant of subject, if any. 

-    Inheritance: Inheritance of Candidate_Variant, if any. 

-    P2_path: Path to the VCF files generated by the P2 pipeline.

-    MD_path: Path to the mosdepth 1kb-bin BED files used for read-depth analysis.

-    BAM_path: Path to the subject's BAM/CRAM file.

-    GATK_path: Path to the JointCall VCF output.

| pt_id | family | project | is_proband | is_trio | CNV_outlier | sex | system | phenotype | Candidate_Variant | Inheritance | P2_path | MD_path | BAM_path | GATK_path |
| :--- | :--- | :--- | :---: | :---: | :---: | :--- | :--- | :--- | :---: | :---: | :--- | :--- | :--- | :--- |
| pt1 | fam1 | project1 | 0 | 0 | 0 | MALE | NS6000 | Unaffected | 0 | 0 | /path/to/p2/vcf/file | /path/to/mosdepth/bed/file | /path/to/bam/file | /path/to/GATK/vcf/file |
| pt2 | fam1 | project1 | 0 | 0 | 0 | MALE | NS6000 | Unaffected | 0 | 0 | /path/to/p2/vcf/file | /path/to/mosdepth/bed/file | /path/to/bam/file | /path/to/GATK/vcf/file |
| pt3 | fam1 | project1 | 0 | 0 | 0 | MALE | NS6000 | Unaffected | 0 | 0 | /path/to/p2/vcf/file | /path/to/mosdepth/bed/file | /path/to/bam/file | /path/to/GATK/vcf/file |

1. Create clustered calls file using helper files (each caller has its corresponding file)

```python

python3 -m helper.*_cluster
```

2. Load to SQL database 

Please edit config file /helper/sqlite_config.yaml and run the following command

```python
python3 -m helper.to_sqlite
```
